<!DOCTYPE HTML>
<!--
	Spectral by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>VisualUN</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
		<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js" integrity="sha512-KhIBJeCI4oTEeqOmRi2gDJ7m+JARImhUYgXWiOTIp9qqySpFUAJs09erGKem4E5IPuxxSTjavuurvBitBmwE0w==" crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<style>

		</style>
	</head>
	<body class="landing">

		<!-- Page Wrapper -->
			<div id="page-wrapper">

				<!-- Header -->
					<header id="header" class="alt">
						<h1><a href="index.html">Visual UN - Proyecto de profundización</a></h1>
						<nav id="nav">
							<ul>
								<li class="special">
									<a href="#menu" class="menuToggle"><span>Menu</span></a>
									<div id="menu">
										<ul>
											<li><a href="index.html">Home</a></li>
											<li><a href="index.html">Introducción</a></li>
											<li><a href="index.html">Mapa</a></li>
											<li><a href="index.html">Grafica</a></li>
										</ul>
									</div>
								</li>
							</ul>
						</nav>
					</header>

				<!-- Banner -->
					<section id="banner">
						<div class="inner">
							<h2>Visual UN - Proyecto de profundización</h2>
							<p>Juan Sebastián Ensuncho  <br />
							Pedro Alejandro Valderrama Tapias <br />
							Esteban Jaramillo Sarmiento <br /> <br />
							Diego Alejandro Gutierrez Rojas <br />
							Johan Sebastian Medina Cañizares <br />
							David Steven Castillo Lopez
						  </p>
							<ul class="actions">
								<li><a href="https://github.com/VisualUN" class="button special">Repositorio</a></li>
							</ul>
						</div>
						<a href="#one" class="more scrolly">Visualización de datos</a>
					</section>

				<!-- One -->
					<section id="one" class="wrapper style1 special">
						<div class="inner">
							<header class="major">
								<h2>Concentración de Material Particulado Inferior a 2.5 Micrómetros {PM2.5} Promedio por Estación para el año 2019</h2>
								<p>A pesar de que no son medidas en muchas ciudades, las partículas en suspensión de menos de 2,5 Micrómetros (PM2,5) son un buen
									indicador de la contaminación urbana.
								  Los efectos que tienen esta partículas sobre nuestra salud son muy graves, por su gran capacidad de penetración
									en las vías respiratorias.
								 </p>
							</header>
							<ul class="icons major" style="color:white">
								<a style="border-bottom: none"
									href="https://datosabiertos.bogota.gov.co/dataset/concentracion-de-material-particulado-inferior-a-2-5-micrometros-pm2-5-promedio-rmcab">
									<span style="margin-right: 2em; font-weight: 600">Dataset de datos abiertos Bogotá</span>
									<span style="color: white" class="icon fa-database major style2"></span>
								</a>
							</ul>
						</div>
					</section>

				<section id="one" class="wrapper style1 special">
				<div class="inner" style="height: 32em;min-height: 32em">
						<h2>Concentración de Material Particulado PM2.5 Promedio por Estación para el año 2019</h2>
						<select name="selector" id="selector" style="color: black; font-weight: 600">
							<option value="0">Enero</option>
							<option value="1">Febrero</option>
							<option value="2">Marzo</option>
							<option value="3">Abril</option>
							<option value="4">Mayo</option>
							<option value="5">Junio</option>
							<option value="6">Julio</option>
							<option value="7">Agosto</option>
							<option value="8">Septiembre</option>
							<option value="9">Octubre</option>
							<option value="10">Noviembre</option>
			      	<option value="11">Diciembre</option>
						</select>

						<div class="map" id="map"  style="height: 30em"></div>
				</div>
				</section>

				<section id="two" class="wrapper style1 special" style="background: white">
					<div class="inner" style="height: 100%;min-height: 30em">
						<div class="chart-container" id="chart-container" style="height: 30em"	>
							<canvas id="myChart"  style="background: white;height: 18em"></canvas>
						</div>
					</div>

					<div class="inner" style="height: 30em;min-height: 30em">
						<div  id="chart-container2" style="height: 30em"	>
							<canvas id="myChar2t"  style="background: white;height: 18em"></canvas>
						</div>
					</div>
				</section>


		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>
			<script src="data.js"></script>

			<script>
			var map = L.map('map',{maxZoom: 11}).setView([4.592164298, -74.072166378], 11);
			var myChart = null;
			//var mes = 0;
			const coords =
						[
							[0,0],
							[4.6302747,-74.1616385],
							[4.6124945,-74.1427709],
							[4.6593254,-74.0865351],
							[4.704233,-74.03885],
							[4.612909, -74.114037],
							[4.556652, -74.091644],
							[4.572943, -74.129428],
							[4.809480, -74.054409],
							[4.685278, -74.084984],
							[4.625092, -74.067169],
							[4.742957, -74.081278],
							[4.676602, -74.140628]
						]


		 $(document).ready(function(){
			 $('#selector').change(function() {
				 // $(this).val() will work here
				 let month = $(this).val();
				 updateMap(month);

				});
			});

			function updateMap(mes){
				try{
					map.remove();
				}catch(err){console.log(err)}

				map = L.map('map',{maxZoom: 11}).setView([4.592164298, -74.072166378], 11);
				L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
				}).addTo(map);

				/*
				L.marker([4.592164298, -74.072166378]).addTo(map)
				    .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
				    .openPopup();
				*/

				var heatPoints = [];
				var zone_names = [];
				var contamination_values = [];
				console.log(data[mes])
				//console.log(coords)
				var i = 0;
				Object.keys(data[mes]).forEach(function(key) {
  				console.table('Key : ' + key + ', Value : ' + data[mes][key])
					let contaminationvalue = data[mes][key];
					let heatPoint = [coords[i][0], coords[i][1], contaminationvalue*5]

					//pins
					if(i!=0 && contaminationvalue != 0){
						L.marker([coords[i][0], coords[i][1]]).addTo(map).bindPopup("En "+key+" el valor promedio partículas pm2.5 es: "+contaminationvalue+' µg/m³');
						heatPoints.push(heatPoint);
						zone_names.push(key);
						contamination_values.push(contaminationvalue);
						let heat = L.heatLayer([heatPoint], {radius: contaminationvalue, blur: 35,minOpacity: 2, maxZoom: 11}).addTo(map);
					}
					i = i+1;
				})

				//Charts
				if(myChart!=null){
					$('#myChart').remove(); // this is my <canvas> element
 					$('#chart-container').append('<canvas id="myChart"  style="background: white;height: 18em"></canvas>');
				}
				var ctx = document.getElementById('myChart').getContext('2d');

				myChart = new Chart(ctx, {
					type: 'bar',
					data: {
							labels: zone_names.slice(1),
							datasets: [{
									label: 'Valor promedio partículas pm2.5 en µg/m³',
									data: contamination_values.slice(1),
									backgroundColor: [
	                'rgba(255, 99, 132, 0.2)',
	                'rgba(54, 162, 235, 0.2)',
	                'rgba(255, 206, 86, 0.2)',
	                'rgba(75, 192, 192, 0.2)',
	                'rgba(153, 102, 255, 0.2)',
	                'rgba(255, 159, 64, 0.2)',

									'rgba(255, 99, 132, 0.2)',
	                'rgba(54, 162, 235, 0.2)',
	                'rgba(255, 206, 86, 0.2)',
	                'rgba(75, 192, 192, 0.2)',
	                'rgba(153, 102, 255, 0.2)',
	                'rgba(255, 159, 64, 0.2)',
	            			],
									borderWidth: 3
							}]
					},
					options: {
						responsive: false,
  				  maintainAspectRatio: false,
							scales: {
									yAxes: [{
											ticks: {
													beginAtZero: true
											}
									}]
							}
					}
				});
				// end charts


			}

			updateMap(0);

			</script>

	</body>
</html>
